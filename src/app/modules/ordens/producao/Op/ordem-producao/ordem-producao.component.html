<mat-accordion>
  <mat-expansion-panel [expanded]=true (opened)=true>
    <mat-expansion-panel-header>
      <mat-panel-title style="margin-top: 8px;">
        <h3>Ordens de Producao</h3>
      </mat-panel-title>
    </mat-expansion-panel-header>
  </mat-expansion-panel>
  <br />
  <form [formGroup]="novaOp">
    <div class="d-flex flex-row">
      <mat-form-field style="margin-left: 10px;">
        <mat-select placeholder="Ordem Servico" formControlName="idOrdemServico" (selectionChange)="loadNumeroOs($event)" >
          <mat-option *ngFor="let os of dropOrdemServicos" [value]="os.Id">{{os.Descricao}}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field style="margin-left: 10px; width: 600px;">
        <mat-select placeholder="Cliente" formControlName="idCliente">
          <mat-option *ngFor="let cliente of dropClientes" [value]="cliente.Id">{{cliente.Descricao}}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="d-flex flex-row">
      <mat-form-field style="margin-left: 10px;">
        <input matInput placeholder="Prazo"
               formControlName="prazo"
               min="0" max="9999"
               required (keypress)="numericOnly($event)" >
      </mat-form-field>
    </div>

    <div class="d-flex flex-row">
      <mat-card  style="width: 100%;">
        <mat-card-header class="justify-content-between">
          <mat-card-title>Items</mat-card-title>
          <mat-card-actions  align="end">
            <button mat-mini-fab color="primary" (click)="mostraConteudo()">
              <mat-icon>plus_one</mat-icon>
            </button>
          </mat-card-actions>
        </mat-card-header>

      <ng-container *ngIf="this.conteudo" >
      <div class="d-flex flex-row">
        <form [formGroup]="detalhesOP">
          <input type="hidden" formControlName="idDetalhesOrdemProducao" name="idDetalhesOrdemProducao">
          <input type="hidden" formControlName="idOrdemProducao" name="idOrdemProducao">
          <mat-form-field fxFlex="50">
            <input matInput placeholder="Descricao" formControlName="descricao" name="descricao">
          </mat-form-field>

          <mat-form-field style="margin-left: 5px;" fxFlex="20">
            <input matInput placeholder="Quantidade"
                   min="0" max="9999999"
                   required (keypress)="numericOnly($event)"
                   formControlName="qtd" name="qtd">
          </mat-form-field>

          <mat-form-field style="margin-left: 5px;" fxFlex="30">
            <mat-select placeholder="Unidade" formControlName="unidade" name="unidade">
              <mat-option *ngFor="let unidade of unidades" [value]="unidade.Id">{{unidade.Descricao}}</mat-option>
            </mat-select>
          </mat-form-field>

          <div style="margin-top: 20px; margin-left: 15px;" fxFlex="5">
            <button mat-flat-button color="primary" (click)="adicionaDetalhe()">Add</button>
          </div>
        </form>
      </div>
      <div class="d-flex flex-row">
        <ng-container>
          <div style="width: 100%;">
            <table mat-table [dataSource]="detalhesOrdemProducao" class="mat-elevation-z8">
              <ng-container matColumnDef="descricao">
                <th mat-header-cell *matHeaderCellDef>Descricao</th>
                <td style="width: 200px;" mat-cell *matCellDef="let detalhe">{{detalhe.descricao}}</td>
              </ng-container>
              <ng-container matColumnDef="qtd">
                <th mat-header-cell *matHeaderCellDef>Quantidade</th>
                <td style="width: 150px;" mat-cell *matCellDef="let detalhe">{{detalhe.quantidade}}</td>
              </ng-container>
              <ng-container matColumnDef="unidade">
                <th mat-header-cell *matHeaderCellDef>Unidade</th>
                <td style="width: 200px;" mat-cell *matCellDef="let detalhe">{{detalhe.unidade}}</td>
              </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
             <tr mat-row *matRowDef="let row;
                 columns: displayedColumns;"
                 (click)="getItemLista(row)">
             </tr>
          </table>
          </div>
        </ng-container>
      </div>
    </ng-container>
      </mat-card>
    </div>

    <div class="d-flex flex-row justify-content-end" style="margin-top: 100px;">
      <a [routerLink]="['/ordens/producao']"  class="btn btn-danger">Cancelar</a>
      <button style="margin-left: 10px; margin-right: 20px;" mat-raised-button color="primary" (click)="onSubmit()">{{ isUpdate ? 'Atualizar' : 'Adicionar'}}</button>
    </div>
  </form>

</mat-accordion>
